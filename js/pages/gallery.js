// Gallery data structure
const galleryImages = {
    flowers: [
        {
            src: '../images/galleryimages/bud10.jpg',
            title: 'Premium Cannabis',
            description: 'High-grade flower selection'
        },
        {
            src: '../images/galleryimages/bud11.jpg',
            title: 'Exotic Strain',
            description: 'Premium cannabis variety'
        },
        {
            src: '../images/galleryimages/bud12.jpg',
            title: 'Top Shelf',
            description: 'Premium grade cannabis'
        },
        {
            src: '../images/galleryimages/bud13.jpg',
            title: 'Premium Selection',
            description: 'Hand-picked cannabis flower'
        },
        {
            src: '../images/galleryimages/bud14.jpg',
            title: 'Quality Flower',
            description: 'Premium cannabis selection'
        },
        {
            src: '../images/galleryimages/bud15.jpg',
            title: 'Premium Grade',
            description: 'Top-shelf cannabis'
        },
        {
            src: '../images/galleryimages/bud17.jpg',
            title: 'Elite Strain',
            description: 'Premium cannabis variety'
        },
        {
            src: '../images/galleryimages/flower1.jpg',
            title: 'Premium Flower',
            description: 'High-quality cannabis'
        },
        {
            src: '../images/galleryimages/flower2.jpg',
            title: 'Elite Selection',
            description: 'Premium grade flower'
        },
        {
            src: '../images/galleryimages/flower3.jpg',
            title: 'Top Grade',
            description: 'Premium cannabis selection'
        },
        {
            src: '../images/galleryimages/flower4.jpg',
            title: 'Premium Choice',
            description: 'Hand-selected cannabis'
        },
        {
            src: '../images/galleryimages/flower5.jpg',
            title: 'Quality Selection',
            description: 'Premium grade flower'
        },
        {
            src: '../images/galleryimages/flower6.jpg',
            title: 'Elite Grade',
            description: 'Top-shelf selection'
        },
        {
            src: '../images/galleryimages/flower7.jpg',
            title: 'Premium Quality',
            description: 'Hand-picked flower'
        },
        {
            src: '../images/galleryimages/flower8.jpg',
            title: 'Top Selection',
            description: 'Premium cannabis variety'
        },
        {
            src: '../images/galleryimages/flower9.jpg',
            title: 'Elite Choice',
            description: 'Quality cannabis selection'
        },
        {
            src: '../images/galleryimages/flower10.jpg',
            title: 'Premium Grade',
            description: 'Top-shelf cannabis'
        },
        {
            src: '../images/galleryimages/flower11.jpg',
            title: 'Quality Choice',
            description: 'Premium selection'
        },
        {
            src: '../images/galleryimages/flower12.jpg',
            title: 'Elite Selection',
            description: 'Hand-picked variety'
        },
        {
            src: '../images/galleryimages/flower13.jpg',
            title: 'Premium Variety',
            description: 'Top-grade cannabis'
        },
        {
            src: '../images/galleryimages/flower14.jpg',
            title: 'Quality Grade',
            description: 'Premium flower selection'
        },
        {
            src: '../images/galleryimages/frezayKush.jpg',
            title: 'Frezay Kush',
            description: 'Special strain selection'
        },
        {
            src: '../images/galleryimages/g41.jpg',
            title: 'G41',
            description: 'Premium strain variety'
        }
    ],
    
    events: [
        {
            src: '../images/galleryimages/event1.jpg',
            title: 'Peace World Event',
            description: 'Community gathering'
        },
        {
            src: '../images/galleryimages/event2.jpg',
            title: 'Cannabis Festival',
            description: 'Cultural celebration'
        },
        {
            src: '../images/galleryimages/event3.jpg',
            title: 'Community Meet',
            description: 'Peace World gathering'
        },
        {
            src: '../images/galleryimages/event4.jpg',
            title: 'Special Event',
            description: 'Community celebration'
        },
        {
            src: '../images/galleryimages/event5.jpg',
            title: 'Peace World Meetup',
            description: 'Community event'
        },
        {
            src: '../images/galleryimages/event6.jpg',
            title: 'Cultural Event',
            description: 'Community gathering'
        },
        {
            src: '../images/galleryimages/event7.jpg',
            title: 'Night Event',
            description: 'Special celebration'
        },
        {
            src: '../images/galleryimages/event8.jpg',
            title: 'Community Event',
            description: 'Peace World celebration'
        },
        {
            src: '../images/galleryimages/event9.jpg',
            title: 'Special Gathering',
            description: 'Community meetup'
        },
        {
            src: '../images/galleryimages/event10.jpg',
            title: 'Peace World Meet',
            description: 'Community celebration'
        }
    ],
    
    store: [
        {
            src: '../images/galleryimages/store1.jpg',
            title: 'Peace World Store',
            description: 'Our retail location'
        },
        {
            src: '../images/galleryimages/store2.jpg',
            title: 'Store Interior',
            description: 'Inside Peace World'
        },
        {
            src: '../images/galleryimages/store3.jpg',
            title: 'Product Display',
            description: 'Quality selection'
        },
        {
            src: '../images/galleryimages/store4.jpg',
            title: 'Store Atmosphere',
            description: 'Peace World experience'
        },
        {
            src: '../images/galleryimages/store5.jpg',
            title: 'Store Layout',
            description: 'Modern retail space'
        },
        {
            src: '../images/galleryimages/growstorm13.jpg',
            title: 'Growing Facility',
            description: 'Professional cultivation setup'
        },
        {
            src: '../images/galleryimages/growstorm2.jpg',
            title: 'Indoor Growing',
            description: 'State-of-the-art facility'
        },
        {
            src: '../images/galleryimages/growstorm3.jpg',
            title: 'Cultivation Room',
            description: 'Professional growing environment'
        },
        {
            src: '../images/galleryimages/growstorm4.jpg',
            title: 'Growing Operation',
            description: 'Advanced growing technology'
        },
        {
            src: '../images/galleryimages/growstorm5.jpg',
            title: 'Indoor Garden',
            description: 'Professional growing space'
        },
        {
            src: '../images/galleryimages/growstorm6.jpg',
            title: 'Cultivation Area',
            description: 'Modern growing facility'
        },
        {
            src: '../images/galleryimages/growstorm7.jpg',
            title: 'Growing Space',
            description: 'Professional setup'
        },
        {
            src: '../images/galleryimages/growstorm9.jpg',
            title: 'Facility Overview',
            description: 'Advanced growing system'
        },
        {
            src: '../images/galleryimages/growstorm10.jpg',
            title: 'Growing Environment',
            description: 'Professional cultivation'
        }
    ],
    
    lifestyle: [
        {
            src: '../images/galleryimages/vid1.mp4',
            title: 'Peace World Lifestyle',
            description: 'Community moments'
        },
        {
            src: '../images/galleryimages/vid2.mp4',
            title: 'Culture & Community',
            description: 'Lifestyle moments'
        },
        {
            src: '../images/galleryimages/vid3.mp4',
            title: 'Peace World Culture',
            description: 'Community lifestyle'
        },
        {
            src: '../images/galleryimages/vid4.mp4',
            title: 'Lifestyle Moments',
            description: 'Community culture'
        },
        {
            src: '../images/galleryimages/vid5.mp4',
            title: 'Community Life',
            description: 'Peace World moments'
        },
        {
            src: '../images/galleryimages/vid6.mp4',
            title: 'Cultural Moments',
            description: 'Lifestyle showcase'
        },
        {
            src: '../images/galleryimages/vid7.mp4',
            title: 'Lifestyle Culture',
            description: 'Community showcase'
        },
        {
            src: '../images/galleryimages/vid8.mp4',
            title: 'Peace World Moments',
            description: 'Cultural lifestyle'
        }
    ]
};

// Gallery functionality with enhanced features
document.addEventListener('DOMContentLoaded', function() {
    const galleryGrid = document.querySelector('.gallery-grid');
    const filterButtons = document.querySelectorAll('.filter-btn');
    const searchInput = document.getElementById('gallery-search');
    const lightbox = document.getElementById('lightbox');
    let currentImages = [];
    let currentIndex = 0;

    // Initialize gallery
    loadGallery('all');

    // Search functionality
    searchInput.addEventListener('input', debounce((e) => {
        const searchTerm = e.target.value.toLowerCase();
        if (searchTerm === '') {
            loadGallery('all');
            return;
        }
        
        const filteredImages = Object.values(galleryImages)
            .flat()
            .filter(item => 
                item.title.toLowerCase().includes(searchTerm) ||
                item.description.toLowerCase().includes(searchTerm)
            );
        loadGallery('search', filteredImages);
    }, 300));

    // Filter button click handlers
    filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const category = btn.dataset.category;
            filterButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            loadGallery(category);
        });
    });

    // Function to load gallery items
    function loadGallery(category, customItems = null) {
        const spinner = showLoadingSpinner();

        setTimeout(() => {
            // Remove the spinner
            if (spinner && spinner.parentNode) {
                spinner.remove();
            }

            galleryGrid.innerHTML = '';
            
            if (customItems) {
                currentImages = customItems;
            } else if (category === 'all') {
                currentImages = Object.values(galleryImages).flat();
            } else {
                currentImages = galleryImages[category] || [];
            }

            if (currentImages.length === 0) {
                showNoResults();
                return;
            }

            currentImages.forEach((item, index) => {
                const delay = index * 100;
                const galleryItem = createGalleryItem(item, index, delay);
                galleryGrid.appendChild(galleryItem);
            });

            initializeLazyLoading();
        }, 500);
    }

    // Create gallery item
    function createGalleryItem(item, index, delay) {
        const div = document.createElement('div');
        div.className = 'gallery-item';
        div.style.animationDelay = `${delay}ms`;
        
        // Check if the item is a video (ends with .mp4)
        const isVideo = item.src.toLowerCase().endsWith('.mp4');
        
        if (isVideo) {
            div.classList.add('video-item');
            div.innerHTML = `
                <video 
                    src="${item.src}"
                    muted
                    loop
                    preload="metadata"
                    poster="${item.poster || ''}"
                >
                    Your browser does not support the video tag.
                </video>
                <div class="gallery-item-overlay">
                    <h3>${item.title}</h3>
                    <p>${item.description}</p>
                </div>
                <div class="play-indicator">
                    <i class="fas fa-play"></i>
                </div>
            `;

            const video = div.querySelector('video');
            div.addEventListener('mouseenter', () => {
                video.play().catch(() => {
                    // Handle any autoplay restrictions
                    console.log('Autoplay prevented');
                });
            });
            div.addEventListener('mouseleave', () => {
                video.pause();
                video.currentTime = 0;
            });
        } else {
            div.innerHTML = `
                <img 
                    src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
                    data-src="${item.src}"
                    alt="${item.title}"
                    loading="lazy"
                >
                <div class="gallery-item-overlay">
                    <h3>${item.title}</h3>
                    <p>${item.description}</p>
                </div>
            `;
        }

        // Add click handler for lightbox
        div.addEventListener('click', () => {
            openLightbox(index);
        });

        return div;
    }

    // Lightbox functionality
    function openLightbox(index) {
        currentIndex = index;
        const item = currentImages[currentIndex];
        const isVideo = item.src.toLowerCase().endsWith('.mp4');
        
        const content = isVideo
            ? `<video src="${item.src}" controls autoplay></video>`
            : `<img src="${item.src}" alt="${item.title}">`;

        lightbox.innerHTML = `
            <div class="lightbox-content">
                <button class="close-btn">&times;</button>
                <button class="nav-btn prev-btn"><i class="fas fa-chevron-left"></i></button>
                <div class="lightbox-image-container">
                    ${content}
                </div>
                <button class="nav-btn next-btn"><i class="fas fa-chevron-right"></i></button>
                <div class="lightbox-info">
                    <h3>${item.title}</h3>
                    <p>${item.description}</p>
                </div>
            </div>
        `;

        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
        setupLightboxControls();
    }

    function setupLightboxControls() {
        const closeBtn = lightbox.querySelector('.close-btn');
        const prevBtn = lightbox.querySelector('.prev-btn');
        const nextBtn = lightbox.querySelector('.next-btn');
        const lightboxContent = lightbox.querySelector('.lightbox-content');

        closeBtn.addEventListener('click', closeLightbox);
        prevBtn.addEventListener('click', () => navigateLightbox('prev'));
        nextBtn.addEventListener('click', () => navigateLightbox('next'));
        
        // Add click event to the lightbox background
        lightbox.addEventListener('click', (e) => {
            // Close only if clicking outside the content
            if (e.target === lightbox) {
                closeLightbox();
            }
        });

        document.addEventListener('keydown', handleKeyboardNav);
    }

    function navigateLightbox(direction) {
        const currentVideo = lightbox.querySelector('video');
        if (currentVideo) {
            currentVideo.pause();
        }

        if (direction === 'prev') {
            currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
        } else {
            currentIndex = (currentIndex + 1) % currentImages.length;
        }
        openLightbox(currentIndex);
    }

    function closeLightbox() {
        const currentVideo = lightbox.querySelector('video');
        if (currentVideo) {
            currentVideo.pause();
        }
        lightbox.classList.remove('active');
        document.body.style.overflow = '';
        document.removeEventListener('keydown', handleKeyboardNav);
    }

    function handleKeyboardNav(e) {
        switch(e.key) {
            case 'ArrowLeft':
                navigateLightbox('prev');
                break;
            case 'ArrowRight':
                navigateLightbox('next');
                break;
            case 'Escape':
                closeLightbox();
                break;
        }
    }

    // Lazy loading implementation
    function initializeLazyLoading() {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                    observer.unobserve(img);
                }
            });
        });

        document.querySelectorAll('img[data-src]').forEach(img => {
            imageObserver.observe(img);
        });
    }

    // Loading spinner
    function showLoadingSpinner() {
        // Remove any existing spinner first
        const existingSpinner = document.querySelector('.dots-spinner');
        if (existingSpinner) {
            existingSpinner.remove();
        }

        const dotsSpinner = document.createElement('div');
        dotsSpinner.className = 'dots-spinner';
        
        // Create 12 dots
        for (let i = 0; i < 12; i++) {
            const dot = document.createElement('div');
            dotsSpinner.appendChild(dot);
        }
        
        // Add spinner to gallery grid
        const galleryGrid = document.querySelector('.gallery-grid');
        galleryGrid.innerHTML = '';
        galleryGrid.appendChild(dotsSpinner);

        return dotsSpinner; // Return the spinner element for later removal
    }

    function showNoResults() {
        galleryGrid.innerHTML = `
            <div class="no-results">
                <i class="fas fa-search"></i>
                <p>No images found</p>
            </div>
        `;
    }

    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
});